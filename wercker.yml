box: debian
build:
  steps:
    - install-packages:
      packages: git cmake g++ python libfontconfig1-dev libx11-dev libxcomposite-dev libgl1-mesa-dev libglu1-mesa-dev freeglut3-dev wget gnupg
    - script:
        name: debug
        code: |
          echo 'deb http://apt.llvm.org/stretch/ llvm-toolchain-stretch main' >> /etc/apt/sources.list
          echo 'deb-src http://apt.llvm.org/stretch/ llvm-toolchain-stretch main' >> /etc/apt/sources.list
          wget -O - https://apt.llvm.org/llvm-snapshot.gpg.key | apt-key add -
          apt-get update
          apt-get install -y clang-format-7
          which clang-format-7
    - script:
        name: setup git submodule
        code: |
          git submodule update --init --depth 1
    - script:
        name: check format
        code: |
          clang-format -i -style=file src/*.cpp src/*.h
    - script:
        name: build
        code: |
          cmake .
          make
    - script:
        name: output dummy file
        code: |
          touch $WERCKER_OUTPUT_DIR/dummy
  after-steps:
    - install-packages:
        packages: ruby
    - wantedly/pretty-slack-notify:
        webhook_url: $SLACK_WEBHOOK_URL
        channel: emoji

